name: Sync ada-version file

on:
  push:
    tags:
      - 'v*'   # run only when a version tag is pushed (like v1.2.3)

jobs:
  update-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Extract tag
        run: echo "VERSION=${GITHUB_REF_NAME}" >> $GITHUB_ENV

      - name: Write ada-version file
        run: |
          mkdir -p ada/etc
          echo "${VERSION}" > ada/etc/ada-version

      - name: Commit and push ada-version
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add ada/etc/ada-version
          git commit -m "Update ada-version to ${VERSION}" || echo "No changes"
          git push
